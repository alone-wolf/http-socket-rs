# 测试矩阵与质量门禁

## 1. 测试层次

1. 单元测试：能力选择、状态迁移、错误分类。
2. 集成测试：完整握手、重连恢复、扩展接入。
3. feature 组合测试：最小功能集与常见组合。
4. 回归测试：已修复问题的固定用例。

## 2. 关键测试矩阵

### 协商矩阵

- 版本交集：有/无。
- transport 交集：有/无。
- capability：必需缺失/可选缺失/完全满足。

### 状态机矩阵

- 合法迁移路径全覆盖。
- 非法迁移拒绝并断言错误类型。

### 重连矩阵

- 同 transport 重连。
- 跨 transport 重连（兼容）。
- 不兼容协商导致拒绝 attach。

### 扩展矩阵

- 扩展成功。
- 扩展返回可恢复错误。
- 扩展返回致命错误。

## 3. 质量门禁

- [ ] 核心路径测试必须通过。
- [ ] 新增 feature 至少有一组启用/禁用对照测试。
- [ ] 每个已知 bug 必须有回归测试。
