# 扩展点接入规范

## 1. 扩展分类

- Middleware: 横切行为编排。
- Authenticator: 认证与授权决策。
- Codec: 消息编解码。
- SessionStore: 会话持久化。
- Observability: 日志、trace、metrics 输出。

## 2. 扩展实现约束

- 必须仅依赖公共 trait 与公开类型。
- 不得假设核心私有字段或内部状态布局。
- 不得通过 panic 处理业务失败。

## 3. 生命周期钩子建议

- 握手前：预校验。
- 协商中：能力过滤与策略决策。
- 激活后：数据面观测与审计。
- 关闭前：资源回收与事件落盘。

## 4. 扩展兼容性策略

- 新增 trait 方法优先提供默认实现。
- 扩展注册失败必须结构化返回。
- 非关键扩展失败可按策略降级运行。
